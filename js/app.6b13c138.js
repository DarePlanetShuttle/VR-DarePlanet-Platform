(function(){"use strict";var e={3949:function(e,n,t){var o=t(5130),r=t(6768);const i={id:"app"};function s(e,n,t,o,s,a){const l=(0,r.g2)("router-view");return(0,r.uX)(),(0,r.CE)("div",i,[(0,r.bF)(l)])}var a={name:"App"},l=t(1241);const c=(0,l.A)(a,[["render",s]]);var d=c,u=t(1387),m=t(4232);const g={class:"vh-100 d-flex flex-column justify-content-center align-items-center"},h={class:"login-div"},p={class:"card-body"},f={key:0},v={class:"d-flex flex-column justify-content-between align-items-center w-100"},b={class:"d-flex justify-content-center m-auto"},w=["src"],k={href:"#",class:"nav-link link-body-emphasis px-2 active","aria-current":"page"},y={class:"mt-4"},x=["disabled"],L={key:0,class:"mt-2"},S={class:"list-unstyled"},E=["onClick"],C={class:"model-name"},R={key:1,class:"login-container"},U={class:"d-flex flex-column justify-content-space-center align-items-center"},A=["src"];function D(e,n,t,i,s,a){return(0,r.uX)(),(0,r.CE)("div",{class:"global-div",style:(0,m.Tr)({backgroundImage:`url(${s.backgroundUrl})`,backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"cover"})},[(0,r.Lk)("div",g,[(0,r.Lk)("div",h,[(0,r.Lk)("div",p,[s.isAuthenticated?((0,r.uX)(),(0,r.CE)("div",f,[(0,r.Lk)("div",v,[(0,r.Lk)("div",b,[(0,r.Lk)("img",{src:s.logoUrl,alt:"Company Logo",class:"img-fluid w-75 mb-5"},null,8,w)]),(0,r.Lk)("a",k," Bienvenido/a, "+(0,m.v_)(s.username),1),(0,r.Lk)("a",{href:"#",class:"nav-link link-body-emphasis px-2 logout-btn",onClick:n[0]||(n[0]=(...e)=>a.logout&&a.logout(...e))},"Logout")]),(0,r.Lk)("div",y,[n[5]||(n[5]=(0,r.Lk)("p",{class:"text-start"},"Cargar ficheros por URL:",-1)),(0,r.bo)((0,r.Lk)("input",{type:"text","onUpdate:modelValue":n[1]||(n[1]=e=>s.modelUrl=e),class:"form-control",placeholder:"Introduzca aquí la URL del fichero"},null,512),[[o.Jo,s.modelUrl]]),(0,r.Lk)("button",{class:"btn btn-success mt-2 w-100",disabled:!s.modelUrl,onClick:n[2]||(n[2]=e=>a.load3DModel(s.modelUrl))},"Visualizar fichero",8,x)]),n[7]||(n[7]=(0,r.Lk)("br",null,null,-1)),n[8]||(n[8]=(0,r.Lk)("br",null,null,-1)),n[9]||(n[9]=(0,r.Lk)("p",{class:"text-start mt-4"},"Ficheros de OneDrive:",-1)),(0,r.Lk)("button",{class:"btn btn-primary w-100",onClick:n[3]||(n[3]=(...e)=>a.getOneDriveFiles&&a.getOneDriveFiles(...e))},"Obtener ficheros de OneDrive"),s.models.length>0?((0,r.uX)(),(0,r.CE)("div",L,[n[6]||(n[6]=(0,r.Lk)("i",{class:"bi bi-caret-down-fill dropdown-button"},null,-1)),(0,r.Lk)("ul",S,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(s.models,(e=>((0,r.uX)(),(0,r.CE)("li",{key:e.id},[(0,r.Lk)("button",{class:"btn btn-success mt-2 model-button w-100",onClick:n=>a.load3DModel(e.downloadUrl)},[(0,r.Lk)("span",C,(0,m.v_)(e.name),1)],8,E)])))),128))])])):(0,r.Q3)("",!0)])):(0,r.Q3)("",!0),s.isAuthenticated?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",R,[(0,r.Lk)("div",U,[(0,r.Lk)("img",{class:"img-fluid mb-4",src:s.logoUrl},null,8,A),n[10]||(n[10]=(0,r.Lk)("div",{class:"d-block ms-2"},[(0,r.Lk)("h5",{class:"text-left fw-bold"},"Plataforma de Realidad Virtual"),(0,r.Lk)("p",{class:"text-left mt-0"})],-1))]),n[11]||(n[11]=(0,r.Lk)("hr",{class:"divider"},null,-1)),n[12]||(n[12]=(0,r.Lk)("p",{class:"text-center description"},"Acceda con su correo para comenzar",-1)),(0,r.Lk)("button",{class:"btn btn-primary w-100",onClick:n[4]||(n[4]=(...e)=>a.login&&a.login(...e))},"Login con cuenta Microsoft")]))])])])],4)}t(4114);var F=t(75);const O={auth:{clientId:"f51206fa-fd71-4af6-b2cf-a467b04b294d",authority:"https://login.microsoftonline.com/e08d22db-a9ec-477d-a620-7f8ae4254949",redirectUri:"https://dareplanetshuttle.github.io/VR-DarePlanet-Platform/tabs/validate"},cache:{cacheLocation:"localStorage",storeAuthStateInCookie:!0}},_=new F.vq(O),T=async()=>{await _.initialize()};var I=_,B=JSON.parse('[{"name":"DarePlanet","logo":"/images/general/logos/dareplanet-logo.png","background":"/images/general/backgrounds/general-background.png"},{"name":"Yara","logo":"/images/general/logos/yara-logo.png","background":"/images/general/backgrounds/yara-background.jpg"}]'),P={name:"HomeView",data(){return{isAuthenticated:!1,username:"",userEmail:"",modelUrl:"",models:[],logoUrl:localStorage.getItem("logoUrl")||B[0].logo,backgroundUrl:localStorage.getItem("backgroundUrl")||B[0].background}},async created(){await T(),this.checkAccount()},methods:{async login(){try{const e=await I.loginPopup({scopes:["User.Read","Files.Read"]});this.handleResponse(e)}catch(e){console.error("Login failed:",e)}},logout(){I.logoutPopup(),this.isAuthenticated=!1,this.username="",this.userEmail="",this.models=[],this.logoUrl=B[0].logo,this.backgroundUrl=B[0].background,localStorage.setItem("logoUrl",this.logoUrl),localStorage.setItem("backgroundUrl",this.backgroundUrl)},handleResponse(e){if("dareplanet.com"==e.account.username.split("@")[1]||"yara.com"==e.account.username.split("@")[1])if(console.log(e.account.username.split("@")[1]),e)this.isAuthenticated=!0,this.username=e.account.name,this.userEmail=e.account.username;else{const e=I.getAllAccounts();1===e.length&&(this.isAuthenticated=!0,this.username=e[0].name,this.userEmail=e[0].username)}else alert("Acceso denegado, cierre sesión y consulte al administrador"),this.logout();console.log(this.isAuthenticated),this.isAuthenticated&&this.loadConfig()},checkAccount(){const e=I.getAllAccounts();1===e.length&&("dareplanet.com"==e[0].username.split("@")[1]||"yara.com"==e[0].username.split("@")[1]?(this.isAuthenticated=!0,this.username=e[0].name,this.userEmail=e[0].username,this.loadConfig()):(alert("Acceso denegado, cierre sesión y consulte al administrador"),this.logout()))},async loadConfig(){try{let e=0;"dareplanet.com"==this.userEmail.split("@")[1]?e=0:"yara.com"==this.userEmail.split("@")[1]&&(e=1),this.logoUrl=B[e].logo,this.backgroundUrl=B[e].background,localStorage.setItem("logoUrl",this.logoUrl),localStorage.setItem("backgroundUrl",this.backgroundUrl)}catch(e){console.error("Error loading config:",e)}},async getOneDriveFiles(){try{const e=I.getAllAccounts()[0],{accessToken:n}=await I.acquireTokenSilent({scopes:["Files.Read"],account:e}),t=await fetch("https://graph.microsoft.com/v1.0/me/drive/root:/models:/children",{headers:{Authorization:`Bearer ${n}`}});if(404===t.status)alert("No se encontró la carpeta 'models' en OneDrive. Por favor, cree una carpeta llamada 'models'.");else if(t.ok){const e=await t.json();0===e.value.length?alert("La carpeta 'models' en OneDrive está vacía. Por favor, agregue archivos a la carpeta."):(this.models=e.value.map((e=>({id:e.id,name:e.name,downloadUrl:e["@microsoft.graph.downloadUrl"]}))),console.log(this.models))}else console.error("Error fetching OneDrive files:",t.statusText)}catch(e){console.error("Error acquiring token or fetching files:",e)}},async load3DModel(e){e?(localStorage.setItem("modelUrl",e),this.$router.push({name:"model-viewer"})):console.error("Failed to load the model URL")}}};const j=(0,l.A)(P,[["render",D],["__scopeId","data-v-6cad0708"]]);var V=j;const z={ref:"vrContainer",class:"vr-container"};function X(e,n,t,o,i,s){return(0,r.uX)(),(0,r.CE)("div",z,null,512)}var M=t(8776),W=t(1353),N=t(4005),H=t(2951),$={name:"VRModelViewer",data(){return{modelUrl:null}},mounted(){this.modelUrl=localStorage.getItem("modelUrl"),console.log(this.modelUrl),this.modelUrl?this.initVRScene():console.error("No model URL found.")},methods:{initVRScene(){const e=this.$refs.vrContainer,n=new M.Z58,t=new M.ubm(70,window.innerWidth/window.innerHeight,.1,1e3),o=new M.JeP({antialias:!0});o.setSize(window.innerWidth,window.innerHeight),o.xr.enabled=!0,e.appendChild(o.domElement),e.appendChild(N.Z.createButton(o)),t.position.set(0,10,10);const r=new M.dth(16777215,12303359,2);r.position.set(.5,1,.25),n.add(r);const i=new W.B;i.load(this.modelUrl,(e=>{const t=e.scene;t.position.set(0,1.6,0),n.add(t)}),void 0,(e=>{console.error("An error occurred while loading the GLB model:",e)}));const s=new H.N(t,o.domElement);s.enableDamping=!0,s.dampingFactor=.25,s.enableZoom=!0;const a=()=>{o.setAnimationLoop((()=>{s.update(),o.render(n,t)}))};a(),window.addEventListener("resize",(()=>{t.aspect=window.innerWidth/window.innerHeight,t.updateProjectionMatrix(),o.setSize(window.innerWidth,window.innerHeight)}))}}};const G=(0,l.A)($,[["render",X],["__scopeId","data-v-f5b53836"]]);var J=G;const q={class:"buttons"},Q={class:"dropdown"},Z={class:"selected"},K=["onClick"];function Y(e,n,t,o,i,s){return(0,r.uX)(),(0,r.CE)("div",null,[n[3]||(n[3]=(0,r.Lk)("div",{id:"container"},null,-1)),(0,r.Lk)("div",q,[(0,r.Lk)("button",{id:"removeFurnitureButton",onClick:n[0]||(n[0]=(...e)=>s.handleRemoveFurnitureButtonClick&&s.handleRemoveFurnitureButtonClick(...e))},"Remove Furniture"),(0,r.Lk)("button",{id:"redesignButton",onClick:n[1]||(n[1]=(...e)=>s.handleRedesignButtonClick&&s.handleRedesignButtonClick(...e))},"Redesign")]),(0,r.Lk)("div",Q,[(0,r.Lk)("div",{class:"select",onClick:n[2]||(n[2]=(...e)=>s.toggleDropdown&&s.toggleDropdown(...e))},[(0,r.Lk)("span",Z,(0,m.v_)(i.selectedScene),1),(0,r.Lk)("div",{class:(0,m.C4)(["caret",{"caret-rotate":i.isDropdownOpen}])},null,2)]),(0,r.Lk)("ul",{class:(0,m.C4)(["menu",{"menu-open":i.isDropdownOpen}]),id:"imageMenu"},[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.scenesData.scenes,((e,n)=>((0,r.uX)(),(0,r.CE)("li",{key:n,onClick:e=>s.changeScene(n)},(0,m.v_)(e.name),9,K)))),128))],2)])])}class ee{static createButton(e,n={}){const t=document.createElement("button");function o(){let o=null;async function r(n){n.addEventListener("end",i),await e.xr.setSession(n),t.textContent="EXIT VR",o=n}function i(){o.removeEventListener("end",i),t.textContent="ENTER VR",o=null}t.style.display="",t.style.cursor="pointer",t.style.left="calc(50% - 50px)",t.style.width="100px",t.textContent="ENTER VR";const s={...n,optionalFeatures:["local-floor","bounded-floor","layers",...n.optionalFeatures||[]]};t.onmouseenter=function(){t.style.opacity="1.0"},t.onmouseleave=function(){t.style.opacity="0.5"},t.onclick=function(){null===o?navigator.xr.requestSession("immersive-vr",s).then(r):(o.end(),void 0!==navigator.xr.offerSession&&navigator.xr.offerSession("immersive-vr",s).then(r).catch((e=>{console.warn(e)})))},void 0!==navigator.xr.offerSession&&navigator.xr.offerSession("immersive-vr",s).then(r).catch((e=>{console.warn(e)}))}function r(){t.style.display="",t.style.cursor="auto",t.style.left="calc(50% - 75px)",t.style.width="150px",t.onmouseenter=null,t.onmouseleave=null,t.onclick=null}function i(){r(),t.textContent="VR NOT SUPPORTED"}function s(e){r(),console.warn("Exception when trying to call xr.isSessionSupported",e),t.textContent="VR NOT ALLOWED"}function a(e){e.style.position="absolute",e.style.bottom="20px",e.style.padding="12px 6px",e.style.border="1px solid #fff",e.style.borderRadius="4px",e.style.background="rgba(0,0,0,0.1)",e.style.color="#fff",e.style.font="normal 13px sans-serif",e.style.textAlign="center",e.style.opacity="0.5",e.style.outline="none",e.style.zIndex="999"}if("xr"in navigator)return t.id="VRButton",t.style.display="none",a(t),navigator.xr.isSessionSupported("immersive-vr").then((function(e){e?o():i(),e&&ee.xrSessionIsGranted&&t.click()})).catch(s),t;{const e=document.createElement("a");return!1===window.isSecureContext?(e.href=document.location.href.replace(/^http:/,"https:"),e.innerHTML="WEBXR NEEDS HTTPS"):(e.href="https://immersiveweb.dev/",e.innerHTML="WEBXR NOT AVAILABLE"),e.style.left="calc(50% - 90px)",e.style.width="180px",e.style.textDecoration="none",a(e),e}}static registerSessionGrantedListener(){if("undefined"!==typeof navigator&&"xr"in navigator){if(/WebXRViewer\//i.test(navigator.userAgent))return;navigator.xr.addEventListener("sessiongranted",(()=>{ee.xrSessionIsGranted=!0}))}}}ee.xrSessionIsGranted=!1,ee.registerSessionGrantedListener();var ne=JSON.parse('{"scenes":[{"name":"Dinner room","image":"/images/360/dinner-room.jpg","redesign":"/images/360/redesign-dinner-room.png","remove_furniture":"/images/360/remove-dinner-room.png"},{"name":"Bedroom","image":"/images/360/bedroom.png","redesign":"/images/360/redesign-bedroom.png","remove_furniture":"/images/360/remove-bedroom.png"},{"name":"Bedroom 2","image":"/images/360/second-room.jpg","redesign":"/images/360/redesign-second-room.png","remove_furniture":"/images/360/remove-second-room.png"},{"name":" Diner Room","image":"/images/360/dinner-room.jpg","redesign":"/images/360/redesign-dinner-room.png","remove_furniture":"/images/360/remove-dinner-room.png"},{"name":"Sun Room","image":"/images/360/sunroom.jpg","redesign":"/images/360/redesign-sunroom.png","remove_furniture":"/images/360/remove-sunroom.png"},{"name":"Bath Room","image":"/images/360/bath_forest.jpg","redesign":"/images/360/redesign-bath-forest.png","remove_furniture":""}]}'),te={name:"360-model-viewer",data(){return{scenesData:{scenes:[]},currentScene:0,textures:{},selectedScene:"Escenas",isDropdownOpen:!1}},mounted(){this.init(),window.addEventListener("resize",this.onWindowResize)},beforeUnmount(){window.removeEventListener("resize",this.onWindowResize)},methods:{init(){const e=document.getElementById("container");this.clock=new M.zD7,this.scene=new M.Z58,this.scene.background=new M.Q1f(1052688);const n=new M.$p8(16777215,2.3);this.scene.add(n),this.camera=new M.ubm(70,window.innerWidth/window.innerHeight,1,2e3),this.scene.add(this.camera);const t=new M.Gu$(6,256,256),o=new M._4j({side:M.hsX,displacementScale:-4});this.sphere=new M.eaF(t,o),this.scene.add(this.sphere),this.renderer=new M.JeP,this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setAnimationLoop(this.animate),this.renderer.xr.enabled=!0,this.renderer.xr.setReferenceSpaceType("local"),e.appendChild(this.renderer.domElement),document.body.appendChild(ee.createButton(this.renderer)),this.loadJSONData()},onWindowResize(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)},animate(){if(!this.renderer.xr.isPresenting){const e=this.clock.getElapsedTime();this.sphere.rotation.y+=.0015,this.sphere.position.y=.25*Math.cos(e)}this.renderer.render(this.scene,this.camera)},loadJSONData(){this.scenesData=ne,console.log(this.scenesData),this.scenesData.scenes.length>0&&this.changeScene(0)},changeScene(e){this.currentScene=e,this.selectedScene=this.scenesData.scenes[e].name;const n=this.scenesData.scenes[e].image;console.log("Loading image from:",n);const t=new M.Tap;t.load(n,(e=>{e.colorSpace=M.er$,e.minFilter=M.hxR,e.generateMipmaps=!1,this.sphere.material.map=e,this.sphere.material.needsUpdate=!0,this.textures[this.currentScene]={original:e,current:e,removeFurniture:null,redesign:null},this.loadAdditionalTextures(this.currentScene)}))},loadAdditionalTextures(e){const n=new M.Tap,t=this.scenesData.scenes[e];t.remove_furniture&&n.load(t.remove_furniture,(n=>{n.colorSpace=M.er$,n.minFilter=M.hxR,n.generateMipmaps=!1,this.textures[e].removeFurniture=n})),t.redesign&&n.load(t.redesign,(n=>{n.colorSpace=M.er$,n.minFilter=M.hxR,n.generateMipmaps=!1,this.textures[e].redesign=n}))},handleRemoveFurnitureButtonClick(){const e=this.textures[this.currentScene];e?.removeFurniture?this.toggleTexture("removeFurniture"):console.error("No remove_furniture texture found for the current scene")},handleRedesignButtonClick(){const e=this.textures[this.currentScene];e?.redesign?this.toggleTexture("redesign"):console.error("No redesign texture found for the current scene")},toggleTexture(e){const n=this.textures[this.currentScene];n&&(n.current===n.original?(this.sphere.material.map=n[e],n.current=n[e]):(this.sphere.material.map=n.original,n.current=n.original),this.sphere.material.needsUpdate=!0)},toggleDropdown(){this.isDropdownOpen=!this.isDropdownOpen}}};const oe=(0,l.A)(te,[["render",Y],["__scopeId","data-v-158406cb"]]);var re=oe;function ie(e,n,t,o,i,s){const a=(0,r.g2)("a-asset-item"),l=(0,r.g2)("a-assets"),c=(0,r.g2)("a-sky"),d=(0,r.g2)("a-entity"),u=(0,r.g2)("a-plane"),m=(0,r.g2)("a-scene");return(0,r.uX)(),(0,r.Wv)(m,null,{default:(0,r.k6)((()=>[(0,r.bF)(l,null,{default:(0,r.k6)((()=>[(0,r.bF)(a,{id:"model",src:"/models/myhouse.glb"})])),_:1}),(0,r.bF)(c,{color:"#ECECEC"}),(0,r.bF)(d,{light:"type: ambient; intensity: 0.5"}),(0,r.bF)(d,{light:"type: directional; intensity: 0.6",position:"1 1 0"}),(0,r.bF)(d,{"gltf-model":"/models/myhouse.glb",position:"0 0 0",scale:"1 1 1"}),(0,r.bF)(d,{id:"rig",position:"0 1.6 0"},{default:(0,r.k6)((()=>[(0,r.bF)(d,{id:"camera",camera:"","look-controls":"",position:"0 -1.5 0"}),(0,r.bF)(d,{id:"left-hand","laser-controls":"hand: left","teleport-controls":"cameraRig: #rig; teleportOrigin: #camera; button: trigger; collisionEntities: .teleport-surface"}),(0,r.bF)(d,{id:"right-hand","laser-controls":"hand: right","teleport-controls":"cameraRig: #rig; teleportOrigin: #camera; button: trigger; collisionEntities: .teleport-surface"})])),_:1}),(0,r.bF)(u,{position:"0 0 0",rotation:"-90 0 0",width:"100",height:"100",visible:"false",class:"teleport-surface"})])),_:1})}var se={name:"ModelExperienceViewer"};const ae=(0,l.A)(se,[["render",ie]]);var le=ae;const ce=[{path:"/",component:V},{path:"/scene",name:"model-viewer",component:J},{path:"/360",name:"360-model-viewer",component:re},{path:"/experience",name:"experience-model-viewer",component:le}],de=(0,u.aE)({history:(0,u.LA)("/VR-DarePlanet-Platform/"),routes:ce});var ue=de;(0,o.Ef)(d).use(ue).mount("#app")}},n={};function t(o){var r=n[o];if(void 0!==r)return r.exports;var i=n[o]={exports:{}};return e[o].call(i.exports,i,i.exports,t),i.exports}t.m=e,function(){var e=[];t.O=function(n,o,r,i){if(!o){var s=1/0;for(d=0;d<e.length;d++){o=e[d][0],r=e[d][1],i=e[d][2];for(var a=!0,l=0;l<o.length;l++)(!1&i||s>=i)&&Object.keys(t.O).every((function(e){return t.O[e](o[l])}))?o.splice(l--,1):(a=!1,i<s&&(s=i));if(a){e.splice(d--,1);var c=r();void 0!==c&&(n=c)}}return n}i=i||0;for(var d=e.length;d>0&&e[d-1][2]>i;d--)e[d]=e[d-1];e[d]=[o,r,i]}}(),function(){t.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(n,{a:n}),n}}(),function(){t.d=function(e,n){for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})}}(),function(){t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)}}(),function(){var e={524:0};t.O.j=function(n){return 0===e[n]};var n=function(n,o){var r,i,s=o[0],a=o[1],l=o[2],c=0;if(s.some((function(n){return 0!==e[n]}))){for(r in a)t.o(a,r)&&(t.m[r]=a[r]);if(l)var d=l(t)}for(n&&n(o);c<s.length;c++)i=s[c],t.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return t.O(d)},o=self["webpackChunkmicrosoft_onedrive"]=self["webpackChunkmicrosoft_onedrive"]||[];o.forEach(n.bind(null,0)),o.push=n.bind(null,o.push.bind(o))}();var o=t.O(void 0,[504],(function(){return t(3949)}));o=t.O(o)})();
//# sourceMappingURL=app.6b13c138.js.map